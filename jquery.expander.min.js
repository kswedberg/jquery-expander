/*!
 * Expander - v1.4.8 - 2014-07-08
 * http://plugins.learningjquery.com/expander/
 * Copyright (c) 2014 Karl Swedberg
 * Licensed MIT (http://www.opensource.org/licenses/mit-license.php)
 */

(function(e){e.expander={version:"1.4.8",defaults:{slicePoint:100,preserveWords:!0,showWordCount:!1,countWordsText:" ({{count}} words)",widow:4,expandText:"read more",expandPrefix:"&hellip; ",expandAfterSummary:!1,summaryClass:"summary",detailClass:"details",moreClass:"read-more",lessClass:"read-less",moreLinkClass:"more-link",lessLinkClass:"less-link",collapseTimer:0,expandEffect:"slideDown",expandSpeed:250,collapseEffect:"slideUp",collapseSpeed:200,userCollapse:!0,userCollapseText:"read less",userCollapsePrefix:" ",onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null,afterCollapse:null}},e.fn.expander=function(a){function s(e,a){var s="span",l=e.summary,n=h.exec(l),t=n?n[2].toLowerCase():"";return a?(s="div",n&&"a"!==t&&!e.expandAfterSummary?l=l.replace(h,e.moreLabel+"$1"):l+=e.moreLabel,l='<div class="'+e.summaryClass+'">'+l+"</div>"):l+=e.moreLabel,[l," <",s+' class="'+e.detailClass+'"',">",e.details,"</"+s+">"].join("")}function l(e,a){var s='<span class="'+e.moreClass+'">'+e.expandPrefix;return e.countWordsText=e.showWordCount?e.countWordsText.replace(/\{\{count\}\}/,a.replace(f,"").replace(/\&(?:amp|nbsp);/g,"").replace(/(?:^\s+|\s+$)/,"").match(/\S+/g).length):"",s+='<a href="#" class="'+e.moreLinkClass+'">'+e.expandText+e.countWordsText+"</a></span>"}function n(a,s){return a.lastIndexOf("<")>a.lastIndexOf(">")&&(a=a.slice(0,a.lastIndexOf("<"))),s&&(a=a.replace(p,"")),e.trim(a)}function t(e,a){a.stop(!0,!0)[e.collapseEffect](e.collapseSpeed,function(){var s=a.prev("span."+e.moreClass).show();s.length||a.parent().children("div."+e.summaryClass).show().find("span."+e.moreClass).show(),e.afterCollapse&&e.afterCollapse.call(a)})}function r(a,s,l){a.collapseTimer&&(o=setTimeout(function(){t(a,s),e.isFunction(a.onCollapse)&&a.onCollapse.call(l,!1)},a.collapseTimer))}var i="init";"string"==typeof a&&(i=a,a={});var o,d=e.extend({},e.expander.defaults,a),c=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i,p=d.wordEnd||/(&(?:[^;]+;)?|[a-zA-Z\u00C0-\u0100]+)$/,f=/<\/?(\w+)[^>]*>/g,u=/<(\w+)[^>]*>/g,m=/<\/(\w+)>/g,h=/(<\/([^>]+)>)\s*$/,x=/^(<[^>]+>)+.?/,C=/\s\s+/g,v=function(a){return e.trim(a||"").replace(C," ")},g={init:function(){this.each(function(){var a,i,p,h,C,g,y,S,w,b,E,k,T,L,W=[],I=[],P={},$=this,j=e(this),A=e([]),D=e.extend({},d,j.data("expander")||e.meta&&j.data()||{}),O=!!j.find("."+D.detailClass).length,z=!!j.find("*").filter(function(){var a=e(this).css("display");return/^block|table|list/.test(a)}).length,F=z?"div":"span",U=F+"."+D.detailClass,Q=D.moreClass+"",Z=D.lessClass+"",q=(D.moreLinkClass+"",D.lessLinkClass+"",D.expandSpeed||0),B=v(j.html()),G=(v(j.text()),B.slice(0,D.slicePoint));if(D.moreSelector="span."+Q.split(" ").join("."),D.lessSelector="span."+Z.split(" ").join("."),!e.data(this,"expanderInit")){for(e.data(this,"expanderInit",!0),e.data(this,"expander",D),e.each(["onSlice","beforeExpand","afterExpand","onCollapse","afterCollapse"],function(a,s){P[s]=e.isFunction(D[s])}),G=n(G),C=G.replace(f,"").length;D.slicePoint>C;)h=B.charAt(G.length),"<"===h&&(h=B.slice(G.length).match(x)[0]),G+=h,C++;for(G=n(G,D.preserveWords),g=G.match(u)||[],y=G.match(m)||[],p=[],e.each(g,function(e,a){c.test(a)||p.push(a)}),g=p,i=y.length,a=0;i>a;a++)y[a]=y[a].replace(m,"$1");if(e.each(g,function(a,s){var l=s.replace(u,"$1"),n=e.inArray(l,y);-1===n?(W.push(s),I.push("</"+l+">")):y.splice(n,1)}),I.reverse(),O)w=j.find(U).remove().html(),G=j.html(),B=G+w,S="";else{if(w=B.slice(G.length),b=e.trim(w.replace(f,"")),""===b||b.split(/\s+/).length<D.widow)return;S=I.pop()||"",G+=I.join(""),w=W.join("")+w}D.moreLabel=j.find(D.moreSelector).length?"":l(D,w),z?w=B:"&"==G.charAt(G.length-1)&&(strayChars=/^[#\w\d\\]+;/.exec(w),strayChars&&(w=w.slice(strayChars[0].length),G+=strayChars[0])),G+=S,D.summary=G,D.details=w,D.lastCloseTag=S,P.onSlice&&(p=D.onSlice.call($,D),D=p&&p.details?p:D),E=s(D,z),j.html(E),T=j.find(U),L=j.find(D.moreSelector),"slideUp"===D.collapseEffect&&"slideDown"!==D.expandEffect||j.is(":hidden")?T.css({display:"none"}):T[D.collapseEffect](0),A=j.find("div."+D.summaryClass),k=function(e){e.preventDefault(),L.hide(),A.hide(),P.beforeExpand&&D.beforeExpand.call($),T.stop(!1,!0)[D.expandEffect](q,function(){T.css({zoom:""}),P.afterExpand&&D.afterExpand.call($),r(D,T,$)})},L.find("a").unbind("click.expander").bind("click.expander",k),D.userCollapse&&!j.find(D.lessSelector).length&&j.find(U).append('<span class="'+D.lessClass+'">'+D.userCollapsePrefix+'<a href="#" class="'+D.lessLinkClass+'">'+D.userCollapseText+"</a></span>"),j.find(D.lessSelector+" a").unbind("click.expander").bind("click.expander",function(a){a.preventDefault(),clearTimeout(o);var s=e(this).closest(U);t(D,s),P.onCollapse&&D.onCollapse.call($,!0)})}})},destroy:function(){this.each(function(){var a,s,l=e(this);l.data("expanderInit")&&(a=e.extend({},l.data("expander")||{},d),s=l.find("."+a.detailClass).contents(),l.removeData("expanderInit"),l.removeData("expander"),l.find(a.moreSelector).remove(),l.find("."+a.summaryClass).remove(),l.find("."+a.detailClass).after(s).remove(),l.find(a.lessSelector).remove())})}};return g[i]&&g[i].call(this),this},e.fn.expander.defaults=e.expander.defaults})(jQuery);